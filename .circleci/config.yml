version: 2

executors:
  go:
    docker:
      - image: circleci/golang:1.12
    environment:
      GO111MODULES: on

  goreleaser:
    docker:
      - image: goreleaser/goreleaser

jobs:
  release-test:
    executor: goreleaser
    working_directory: /go/src/github.com/greenled/portainer-stack-utils
    steps:
    - checkout
    - setup_remote_docker:
    - run: goreleaser --skip-publish --snapshot

  release:
    executor: goreleaser
    working_directory: /go/src/github.com/greenled/portainer-stack-utils
    steps:
      - checkout
      - setup_remote_docker:
      - run: goreleaser
